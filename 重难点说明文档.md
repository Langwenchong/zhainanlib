### **项目结构规划**

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422200633057.png)

由于是关联性极强的多页面跳转项目，因此建立结构清晰的项目结构解析是有必要的，上图是本项目的各文件之间的解析关系。为了实现多页面之间的局部跳转渲染，并没有使用传统的多个html页面跳转的方式来建立项目，而是采用vue-cli创建vue项目来进行项目的开发。

其中使用static+main.js来实现项目的全局js,css,jQuery,ehcarts,vux和swiper.js等外部依赖的引入和组件注册，同时在static/images统一存放素材，从而实现开发组件与依赖相分离的设计开发模式，这样开发过程中只用专注于components文件夹下的自定义组件即可，大大提升开发的效率。

### 适应index.js路由实现页面跳转

这里使用vue.js提供的vue-Router来实现组件的局部跳转：

> Vue Router 是 [Vue.js](http://cn.vuejs.org/) 官方的路由管理器。它和 Vue.js 的核心深度集成，让构建单页面应用变得易如反掌。包含的功能有：基于vue.js过渡系统的视图过渡效果、细粒度的导航控制、模块化的、基于组件的路由配置  ---vue.js

这里我将每一个组件的嵌套关系定义在router/index.js下从而实现利用路由管理器进行组件的刷新跳转：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422201738056.png)

因此Homepage是最底层的容器元素，用来动态显示hotnews,付费订阅，特别策划三大主题板块组件的显式。同时hotnews下有嵌套有style1和style2两个渲染板块来实现交叉渲染。因此hotnews既是Homepage的子元素，同时hotnews又是style1和style2的容器元素，从而实现组件之间的多层嵌套关系：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422202434911.png)

这样Homepage下通过\<Router-to\>和\<Router-view\>实现了三个主题板块的动态渲染展示，同时Hotnews作为次容器又通过\<Router-view\>实现两个子组件style1.vue和style2.vue的交叉渲染。两层组件的动态跳转的嵌套关系在路由index.js文件中进行定义从而实现正确的组件跳转。

同时使用vue.Router提供的组件跳转动画class:

```css
.v-enter,
.v-leave-to {
  opacity: 0;
  transform: translateY(60px);
}
.v-enter-active,
.v-leave-active {
  transition: all 0.7s;
}
```

定义组件跳转的过渡动画，从而实现了本项目不同组件刷新时的slideUp滑动过渡效果。

#### 纯CSS实现轮播图效果

在Homepage首页中有一个自动定时切换的轮播图板块，这里并没有使用Js来实现，而是选择使用纯css实现：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422203113143.png)

实现方法是使用容器overflow:hidden属性将溢出元素进行隐藏，设定特定的宽度保证每一次只能够有一个子元素slide显示，其他的slide元素全部溢出在容器之外，由于容器元素使用了overflw:hidden属性对溢出子元素实现了隐藏效果，同时定时改变5个slide元素的translateX属性来实现子元素的水平轴偏移，从而制作出多图切换的效果。同时为每一个slide元素绑定唯一的input-radio单选按钮，并将单选按钮进行样式重写实现轮播图上侧的选择按钮跳转特定图片的功能。同时使用jQuery提供的slideup动画函数来显示鼠标悬浮后出现的文本框动画，在用setInterval()函数实现定时切换图片的功能。自此一个纯css实现的动画轮播图板块就完美实现，不需要引入任何第三方js文件，从而减少了页面加载时的消耗。

#### Hotnews页面的交叉渲染展示板块

这部分是本项目的核心功能，我将针对几个当前前端数据展示亟待解决的需要问题进行代码剖析：

#### 需求一：动态渲染展示巨大数量级数据信息

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422203908733.png)

这部分是本项目的核心功能，在Hotnews板块的中心部分展示了多组分类后的动漫信息，每组动漫信息使用了两种不同的渲染模式进行展示。第一种是左侧一个大正方形+右侧四个小正方组成田字格的形式，另一种是四个长方形卡片并列排布的样式。这里的两种不同样式交叉显示分类动漫信息并不是使用:nth-child伪类对固定的html结构进行渲染，仔细观察hotnews下的html结构会发现其实hotnews7个展示板块仅仅使用了下面不到20行的代码就实现了交叉渲染展示的功能。

```css
<div class="project" v-for="(project,i) in projects" :key="project.title">
        <div class="pro-title">
          <img v-lazy="project.url" height="30px" />
          <p>{{project.title}}</p>
          <div class="refresh" @click="refresh(i)">
            <img src="../../static/images/refresh.png" height="15px" />
            <p>换一换</p>
          </div>
          <div class="more">
            <p>更多内容</p>
            <img src="../../static/images/more.png" height="15px" />
          </div>
        </div>
```

实际上这里的分组专栏信息并不是写死的，而是使用v-for循环遍历动态渲染div元素实现的。每一个专栏映射为一个project对象，同时将多个专栏对象进行封装后放到一个projects数组中，从而借助vue.js的v-for动态遍历循环渲染专栏信息。因此每一个project对象中存储有一个专栏的所有图片和文字介绍以及icon图标，如下：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422204842712.png)

正式借助vue.js可以使用v-for来动态渲染组件的功能，当我们需要解决交叉渲染数千个专栏信息的时候，并不需要提前写好上千个专栏的html框架，而只是仅仅需要将数千个专栏的信息放到projects数组中，即可通过上面短短的20还能够v-for代码就可以实现动态渲染数千个专栏。当需要更新专栏个数时，也无需向传统的html写法那样大动干戈的对html结构进行重写，而仅仅是删除projects对应的专栏信息即可。同时这种方法不当解决了动态渲染巨大数量级信息的需求，同时也可以随时通过api接受不可提前预测的对象信息来进行信息渲染。我们可以推理对于bilibili和网易云等多个专栏的数据展示一定不是使用传统的html构建方式对每一个专栏进行代码创建，而是使用与我这种思路类似的多组件渲染的方法实现的。

#### 需求二：样式交叉渲染展示数据

对于当前的主流页面，大体上都不是使用同一个样式展示所有的数据的，而是采用多种样式，不同风格的方式交叉展示信息，例如以下是智慧树教学平台的数据展示效果：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422210151115.png)

我们可以看到它采用的是两种不同的样式进行数据的交叉渲染展示，因此我这里也采用了这种方法来实现数据的交叉样式渲染。首先我创建了两个不同样式的展示数据的组件命名为style1和style2，然后使用vue.js提供的is属性+computed计算功能对所有奇数的project专栏信息使用style1.vue组件进行数据展示，而偶数的project专栏信息使用style2.vue组件进行数据展示。这样就实现了更加优雅的多样式交叉渲染展示数据的功能，我们可以继续优化这个思路，定义3个甚至5个不同样式的子组件，然后同样使用is+computed功能就可以实现更加高效的多样式交叉渲染展示数据的功能。

#### 需求三：每一个专栏可以使用换一换刷新展示数据

我们参考bilibili的换一换功能：

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422210723404.png)

每一个专栏实际上存储有上百个信息，但是每次只展示部分数据，当需要显示更多数据时可以点击换一换按钮刷新展示不同的数据，这里我同样实现了这个需求。实际上思路很简单，为每一个project专栏对象创建一个data数组来存储信息，其中可以存储数百个信息，然后每次只展示5个信息，当点击换一换按钮时切换索引例如索引值+5就可以实现刷新展示更多不同数据的功能，但是这里遇到了一个问题。如何保证每一个换一换功按钮只刷新对应的专栏的信息而不会干扰其他专栏？这里我通过为每一个v-for循环遍历出的div块绑定了一个专属的key值从而加以区分，这正好可以使用vue.js中v-for提供的key值绑定属性。同时还需要解决一个问题，就是如何保证组件快速刷新展示新的数据？如果直接使用=对索引值进行加5的操作，那么会有一个非常明显的数据刷新空白期，这里我尝试使用子组件自毁重新加载的方法来实现，但是效果不尽人意，因为这会导致有一个明显的组件重新加载渲染的过程，阅读完vue2.0文档后我们可以看到开发者注意到了这个问题，他提供了一个非常完美的解决方案，即使用原生js提供的Arrays自带的slice和push操作来完成索引值的修改，这样就可以实现数据的完美刷新，而不会有很明显的空档期。

#### 评论区功能

![](https://gitee.com/Langwenchong/figure-bed/raw/master/image-20210422211811461.png)

很明显这部分需要实时根据后台提供的信息进行渲染展示数据，同时当发表评论时需要能够快速展示。这里我们同样不能使用传统的html来实现，也无需引入外部js实现，完全可以使用vus.js的v-for来实现，我们将每一条评论封装成一条comments对象（有发表者信息，评论内容，发表时间等属性），然后将所有的comment对象放入一个数组即可。因此当加载评论时实际上只需要后端提供一个接口来获取一个评论信息数组即可，我们可以通过v-for快速实现评论信息的加载和渲染。当发表言论时，我们只需要通过query选择器获取到input框内输入的信息后，使用js的Dtae对象后，将评论进行封装成一个comment对象，然后加入到comments数组中即可实现评论的发表。

#### 自我总结

一个项目的开发总是需要倾注开发者无数心血，例如本次项目的重难点并不仅仅限于上面的内容，代码的平稳退化从而适应对个浏览器，页面的移动适配从而实现三端共用一套代码等都是需要开发者经过代码逻辑的构思后才能实现。
